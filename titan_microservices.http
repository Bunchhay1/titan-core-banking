### ğŸŒ GLOBAL CONFIGURATION
@host =  http://100.117.33.69:8000/api/v1
@contentType = application/json

# ğŸ‘‡ á‚áŸ’ášá¶á“áŸ‹ááŸ‚á”áŸ’áá¼ášá›áŸáá“áŸáŸ‡ášá¶á›áŸ‹á–áŸá› Run ááŸ’á˜á¸ (á§. v10, v11, v12) áŠá¾á˜áŸ’á”á¸á€á»áŸ†á±áŸ’á™á‡á¶á“áŸ‹áˆáŸ’á˜áŸ„áŸ‡á…á¶áŸáŸ‹
@runId = v22

# Auto-Generated Usernames based on runId
@user_sender = sender_{{runId}}
@user_receiver = receiver_{{runId}}

# =================================================================
# ğŸ—ï¸ 1. SETUP PHASE (á”á„áŸ’á€á¾ááá½á¢á„áŸ’á‚ á“á·á„ á‚áá“á¸)
# =================================================================

### 1.1 Register Sender (á¢áŸ’á“á€á•áŸ’á‰á¾)
POST {{host}}/api/auth/register
Content-Type: {{contentType}}

{
  "firstname": "Mr",
  "lastname": "Rich",
  "username": "{{user_sender}}",
  "email": "{{user_sender}}@titan.com",
  "password": "password123",
  "pin": "123456"
}

### 1.2 Login Sender (á™á€ Token)
POST {{host}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "{{user_sender}}",
  "password": "password123"
}

> {%
    client.global.set("token_sender", response.body.token);
    client.log("ğŸ”‘ Sender Token Acquired");
%}

### 1.3 Create Account ($20,000) - á˜á¶á“á›á»á™á…áŸ’ášá¾á“
POST {{host}}/api/accounts
Authorization: Bearer {{token_sender}}
Content-Type: {{contentType}}

{
  "accountType": "SAVINGS",
  "initialDeposit": 20000.00,
  "pin": "123456"
}

> {%
    client.global.set("acc_sender", response.body.accountNumber);
    client.log("ğŸ’° Sender Account: " + response.body.accountNumber);
%}

### 1.4 Register Receiver (á¢áŸ’á“á€á‘á‘á½á›)
POST {{host}}/api/auth/register
Content-Type: {{contentType}}

{
  "firstname": "Ms",
  "lastname": "Staff",
  "username": "{{user_receiver}}",
  "email": "{{user_receiver}}@titan.com",
  "password": "password123",
  "pin": "123456"
}

### 1.5 Login Receiver
POST {{host}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "{{user_receiver}}",
  "password": "password123"
}

> {%
    client.global.set("token_receiver", response.body.token);
%}

### 1.6 Create Account Receiver ($0)
POST {{host}}/api/accounts
Authorization: Bearer {{token_receiver}}
Content-Type: {{contentType}}

{
  "accountType": "SAVINGS",
  "initialDeposit": 0.00,
  "pin": "123456"
}

> {%
    client.global.set("acc_receiver", response.body.accountNumber);
    client.log("ğŸ‘› Receiver Account: " + response.body.accountNumber);
%}

###

# =================================================================
# ğŸ›‘ 2. TEST LOGIC: DUPLICATE USER CHECK
# =================================================================
# áŸá¶á€á”á„áŸ’á€á¾ááˆáŸ’á˜áŸ„áŸ‡áŠáŠáŸ‚á› (ááŸ’ášá¼áœááŸ‚ Error 400/500)
POST {{host}}/api/auth/register
Content-Type: {{contentType}}

{
  "firstname": "Fake",
  "lastname": "Hacker",
  "username": "{{user_sender}}",
  "email": "fake@titan.com",
  "password": "password123",
  "pin": "123456"
}

> {%
    client.test("Prevent Duplicate User", function() {
        client.assert(response.status !== 200, "âŒ Failed! Should block duplicate username.");
        client.log("âœ… Security Check: Duplicate user blocked.");
    });
%}

###

# =================================================================
# ğŸ›¡ï¸ 3. TEST LOGIC: INSUFFICIENT BALANCE
# =================================================================
# á˜á¶á“á›á»á™ $20,000 áŸá¶á€áœáŸáš $30,000
POST {{host}}/api/transactions/transfer
Authorization: Bearer {{token_sender}}
Content-Type: {{contentType}}

{
  "fromAccountNumber": "{{acc_sender}}",
  "toAccountNumber": "{{acc_receiver}}",
  "amount": 30000.00,
  "pin": "123456",
  "note": "Overdraft Test"
}

> {%
    client.test("Insufficient Balance", function() {
        client.assert(response.status === 400 || response.status === 500, "Status should be error");
        // á˜á¾á› response body áá¶áá¾á˜á¶á“ message ááŸ’ášá¹á˜ááŸ’ášá¼áœá¢ááŸ‹
        client.log("âœ… Logic Check: " + JSON.stringify(response.body));
    });
%}

###

# =================================================================
# ğŸ¤– 4. TEST LOGIC: AI RISK BLOCK (> $10,000)
# =================================================================
# áœáŸáš $15,000 (á˜á¶á“á›á»á™á‚áŸ’ášá”áŸ‹) -> á”áŸ‰á»á“áŸ’ááŸ‚ Python ááŸ’ášá¼áœ Block á–áŸ’ášáŸ„áŸ‡ > 10k
POST {{host}}/api/transactions/transfer
Authorization: Bearer {{token_sender}}
Content-Type: {{contentType}}

{
  "fromAccountNumber": "{{acc_sender}}",
  "toAccountNumber": "{{acc_receiver}}",
  "amount": 15000.00,
  "pin": "123456",
  "note": "Money Laundering Attempt"
}

> {%
    client.test("AI Risk Block", function() {
        client.assert(response.status !== 200, "âŒ Error! AI should have blocked this!");
        var body = JSON.stringify(response.body);
        client.assert(body.includes("BLOCKED") || body.includes("Risk"), "âŒ Message mismatch");
        client.log("âœ… AI Security: High value transaction BLOCKED!");
    });
%}

###

# =================================================================
# âœ… 5. TEST LOGIC: HAPPY PATH (< $10,000)
# =================================================================
 áœáŸáš $100 -> ááŸ’ášá¼áœááŸ‚á‡áŸ„á‚á‡áŸá™ (Golang á•áŸ’á‰á¾áŸá¶áš)
POST {{host}}/api/transactions/transfer
Authorization: Bearer {{token_sender}}
Content-Type: {{contentType}}

{
  "fromAccountNumber": "{{acc_sender}}",
  "toAccountNumber": "{{acc_receiver}}",
  "amount": 100.00,
  "pin": "123456",
  "note": "Coffee Money"
}

> {%
    client.test("Normal Transfer", function() {
        client.assert(response.status === 200, "Should be 200 OK");
        client.log("âœ… Success: Normal transfer completed.");
    });
%}

###

# =================================================================
# ğŸ›‘ 6. TEST LOGIC: NEGATIVE AMOUNT
# =================================================================
# áœáŸáš -$50
POST {{host}}/api/transactions/transfer
Authorization: Bearer {{token_sender}}
Content-Type: {{contentType}}

{
  "fromAccountNumber": "{{acc_sender}}",
  "toAccountNumber": "{{acc_receiver}}",
  "amount": -50.00,
  "pin": "123456",
  "note": "Hacking Negative"
}

> {%
    client.test("Negative Amount Block", function() {
        // á”á¾ Commander á”á¶á“áŠá¶á€áŸ‹ @Min(0) áœá¶á“á¹á„á…áŸá‰ 400
        client.assert(response.status !== 200, "Should fail");
        client.log("âœ… Validation: Negative amount blocked.");
    });
%}